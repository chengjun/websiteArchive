<!DOCTYPE html>
<html lang="zh-cn">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.37.1" />
  <meta name="author" content="Cheng-Jun Wang">
  <meta name="description" content="Associate Professor">

  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  


  

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7cMerriweather%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="https://chengjunwang.com/index.xml" type="application/rss+xml" title="Cheng-Jun Wang">
  <link rel="feed" href="https://chengjunwang.com/index.xml" type="application/rss+xml" title="Cheng-Jun Wang">
  

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="https://chengjunwang.com/zh/post/cn/cn_archive/2012-07-01-snabook-chapter4/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@ChengJunWang">
  <meta property="twitter:creator" content="@ChengJunWang">
  
  <meta property="og:site_name" content="Cheng-Jun Wang">
  <meta property="og:url" content="https://chengjunwang.com/zh/post/cn/cn_archive/2012-07-01-snabook-chapter4/">
  <meta property="og:title" content="第4章 派系、聚类和组元 | Cheng-Jun Wang">
  <meta property="og:description" content="">
  <meta property="og:locale" content="zh-cn">
  
  <meta property="article:published_time" content="2012-07-01T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2012-07-01T00:00:00&#43;00:00">
  

  

  <title>第4章 派系、聚类和组元 | Cheng-Jun Wang</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/zh/">Cheng-Jun Wang</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/zh/#about">
            
            <span>关于</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#posts">
            
            <span>新闻</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#teaching">
            
            <span>教学</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#projects">
            
            <span>项目</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#contact">
            
            <span>联系</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  


<div class="col-sm-2 col-sm-offset-1 doc-sidebar right">

	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			
			
		</div>
	</div>
	
	</div>

</div>



  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">第4章 派系、聚类和组元</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2012-07-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      2012-07-01
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 分钟阅读时间
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="https://chengjunwang.com/zh/post/cn/cn_archive/2012-07-01-snabook-chapter4/#disqus_thread"></a>
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=%e7%ac%ac4%e7%ab%a0%20%e6%b4%be%e7%b3%bb%e3%80%81%e8%81%9a%e7%b1%bb%e5%92%8c%e7%bb%84%e5%85%83&amp;url=https%3a%2f%2fchengjunwang.com%2fzh%2fpost%2fcn%2fcn_archive%2f2012-07-01-snabook-chapter4%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fchengjunwang.com%2fzh%2fpost%2fcn%2fcn_archive%2f2012-07-01-snabook-chapter4%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchengjunwang.com%2fzh%2fpost%2fcn%2fcn_archive%2f2012-07-01-snabook-chapter4%2f&amp;title=%e7%ac%ac4%e7%ab%a0%20%e6%b4%be%e7%b3%bb%e3%80%81%e8%81%9a%e7%b1%bb%e5%92%8c%e7%bb%84%e5%85%83"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fchengjunwang.com%2fzh%2fpost%2fcn%2fcn_archive%2f2012-07-01-snabook-chapter4%2f&amp;title=%e7%ac%ac4%e7%ab%a0%20%e6%b4%be%e7%b3%bb%e3%80%81%e8%81%9a%e7%b1%bb%e5%92%8c%e7%bb%84%e5%85%83"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=%e7%ac%ac4%e7%ab%a0%20%e6%b4%be%e7%b3%bb%e3%80%81%e8%81%9a%e7%b1%bb%e5%92%8c%e7%bb%84%e5%85%83&amp;body=https%3a%2f%2fchengjunwang.com%2fzh%2fpost%2fcn%2fcn_archive%2f2012-07-01-snabook-chapter4%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        <p></p>

<p>在前面章节中，我们主要分析了社会网络中的个体特征。从这一章开始， 我们将开始循序渐进探讨网络中的更大的分析单元，不仅分析个体及其相互联系特征，还要分析所有子图和聚类的特征。我们将探索处于一个三元组当中到底意味着什么，以及作为结构洞的好处和压力。
首先，我们将通过逐步去除部分网络的方法来解构网络，以便找到网络的核心(有时有多个核心)；接着，我们将使用网络的组分（二元组、三元组、派系、家族和聚类）来重构网络。</p>

<p>##4.1组元和子图
为了将网络分解为可分析的单元，我们将首先给出一些定义：</p>

<p>•   子图 子图（subgraph）是由一个网络的部分节点及这些节点之间的链接构成。任意一组节点都可以构成子图，稍后我们会介绍一些使用子图的有趣的方法。</p>

<p>•   组元 组元（components)）是由网络当中相互分隔的部分构成。比如，在罗密欧和朱丽叶相遇之前，他们所在的两个家族没有联系（互相仇视，水火不容），因而可以被看作两个组元。</p>

<p>许多真实的网络，尤其是那些通过随机抽样搜集到的网络数据，有很多组元存在。有些人可以质疑这是抽样误差（这是很有可能的）造成，但同时，这也可能只是意味着这些组元之间的链接在样本框之外，因此实际上这些组元之间本来就没有关联。</p>

<p>###使用Python分析组元
埃及暴动的推特转发网络是一个具有很多组元的网络的好例子。本书所讨论的推特转发网络数据，因为只收集了1%的推特用户所发的微博信息，所以很不完整。让我们读入并检查该数据。NetworkX包含一个分析孤立的相互关联的组元的命令（connected_component_subgraphs(e); 这个命令可以根据各个相互关联的组元返回其相应的图对象的数组）：</p>

<pre><code>&gt;&gt;&gt; e=net.read_pajek(&quot;egypt_retweets.net&quot;)
&gt;&gt;&gt; len(e)
25178
&gt;&gt;&gt; len(net.connected_component_subgraphs(e))
3122
</code></pre>

<p>以上程序表明这个转发网络包含约25000个节点，但这个网络被分割成为超过3000个组元的子图。我们现在可以分析这些组元的规模大小的分布：</p>

<pre><code>&gt;&gt;&gt; import matplotlib.pyplot as plot
&gt;&gt;&gt; x=[len(c) for c in net.connected_component_subgraphs(e)]
&gt;&gt;&gt; plot.hist()
</code></pre>

<p>在约3100个组元中，有2471个组元的规模是1——这些节点被称之为“孤立点”，并且应该从网络的剔除。有546个组元的大小是2（也就是只有一个转发），67个组元的规模是3， 14个组元的规模是4，11个组元的规模是5。组元的规模等于或大于10的情况，其频数非常小：</p>

<pre><code>&gt;&gt;&gt; [len(c) for c in net.connected_component_subgraphs(e) if len(c) &gt; 10]
[17762, 64, 16, 16, 14, 13, 11, 11]
</code></pre>

<p>以上代码表明存在一个大小超过17000的巨大组元，7个组元的规模小于100，规模介于100到17000之间，不存在任何组元。</p>

<p>在这个特例中，我们可以将这个巨大组元看作整个网络进行分析；但这个网络仍然因为规模太大而不能得出有趣的推论。</p>

<p>###网络中的岛屿
一个分析网络的技术被称之为“岛屿方法”（参见图 4-1）；这种方法尤其适合于分析权重网络，比如我们作为例子的埃及革命的推特转发网络。
岛屿方法按照以下过程工作：将我们的网络想象成一个具有复杂地形的岛屿，地形中每一个点的高度被定义为节点的数值（比如程度中心性）或边（比如转发量）。现在环绕这个岛屿的海平面高度随着时间缓慢增加，使得岛屿随着时间逐渐没于水面以下。到岛上的低谷被海水覆盖，这个岛屿就被分割为众多小岛——使得岛屿的最高峰显露出来，并且随着时间增长，这些显露于海面以上的高峰逐渐变小。</p>

<p><img src="http://farm4.staticflickr.com/3799/9457227648_2c4a787869.jpg" alt="" /></p>

<p>图 4-1 岛屿方法</p>

<p>当海水高度足够高之后，整个岛屿都可能完全消失在海水下面。因为，为了得到有意义的结果，这种方法需要被恰当地使用。</p>

<p>对于网络而言，使用岛屿方法（ island method ）意味着大的组元将被分割为小的组分，并且具有最多的转发量的区域（子核）成为他们各自可以被单独分析的组元。</p>

<p>使用岛屿方法时，我们所需要做的第一件事情是建立一个命令来提高“水平面高度”。这个命令使用一个门槛数值（也就是“水平面高度”）对图进行操作，使得权重超过该门槛值的边保存下来，移除掉剩余的其它的边。不用担心，这个命令会保存原来的图，因此它是非破坏性的（即并不损失信息）：</p>

<pre><code>def trim_edges(g, weight=1):
    g2=net.Graph()
    for f, to, edata in g.edges(data=True):
        if edata['weight'] &gt; weight:
            g2.add_edge(f,to,edata)
    return g2
</code></pre>

<p>现在，我们开始定义“水平面”如何被提高。我们将要生成一组均匀分布的门槛值作为“水平面”，并依据这些“水平面”生成一组网络：</p>

<pre><code>def island_method(g, iterations=5):
    weights= [edata['weight'] for f,to,edata in g.edges(data=True)]

    mn=int(min(weights))
    mx=int(max(weights))
    #compute the size of the step, so we get a reasonable step in iterations
    step=int((mx-mn)/iterations)

    return [[threshold, trim_edges(g, threshold)] for threshold in range(mn,mx,step)]
</code></pre>

<p>以上程序中的函数将返回一组图对象，每一个图对应着一个特定的“水平面”。
现在我们针对埃及革命的推特转发网络中的最大的组元进行分析，先使用岛屿方法将其分割为子部分：</p>

<pre><code>&gt;&gt;&gt; cc=net.connected_component_subgraphs(e)[0]
&gt;&gt;&gt; islands=island_method(cc)
&gt;&gt;&gt; for i in islands:
... # 输出水平面高度、图大小、连接的组件的数量
... print i[0], len(i[1]), len(net.connected_component_subgraphs(i[1]))

        1 12360 314
        62 27 11
        123 8 3
        184 5 2
        245 5 2
</code></pre>

<p>以上程序是什么意思？当门槛值取值为1时，所有取值为1的网络链接（即一步转发的推特）被剥离，这个最大的组元被分割为314个“岛”的子图——每一个代表一组持续地相互转发的人群。因为一次转发可以被认为偶然的，所以这是一个很有用的结果——持续的转发，更常见于那些经常交流并因此培养出某种信任关系的群体当中。</p>

<p>门槛值取值为62（即每对节点之间的最小转发为62）时，只有27个节点保留下来，分布于11个“岛屿”之中。在这个例子当中，62是最有意义的门槛值——剩下的27个节点是最积极地卷入解放广场示威的人和报道这个事件的记者。</p>

<p>这可能需要经过一个试错的过程，但一个设置合理的“水平面”可以针对大的网络生成一个非常有意义的结果——立刻找到网络中最活跃的核心节点。</p>

<p>##4.2子图——自我中心网</p>

<p><strong>自我中心网</strong>（Ego networks）是一个以某一特定节点为核心的子网络。在脸书和LinkedIn上面，自我中心网通常被描述为“你的网络”——但是你只能看到你自己的自我中心网，而不能做一个覆盖范围更为广阔的调查。拥有一个大的数据可以使得我们测量和比较不同人的自我中心网。
我们通过运行一个广度优先搜索（参见本书第2章：广度优先搜索）并且限制搜索的深度（网络半径）为一个通常不超过3的数值的方式，来获得自我中心网。不同的是，在通常的广度优先搜索当中，我们通过构建一个链接树的方式找到要搜索的节点，而为了生成一个自我中心网，我们需要获取特定的中心节点的所有邻居之间的所有链接。</p>

<p>为了理解采用一个小的搜索深度的方法获取自我中心网背后的逻辑，我们需要重温在网络中与其它节点连接意味着什么，以及网络距离的意义是什么。通常情况下，网络链接的一个例子是“爱丽丝是鲍勃的朋友”，一个数值为2的网络距离的一个例子则是“卡洛尔是爱丽丝的一个朋友的朋友”，而一个数值为3的网络距离的例子是“戴夫是爱丽丝的一个朋友的朋友的朋友”。直觉上讲，我们将其理解为虽然我们对我们的朋友了解很多，我们对我们的一些朋友的朋友的情况也略有所知，但我们几乎不知道任何我们朋友的朋友的朋友的事情。</p>

<p>严格地说，网络距离这个概念被表达为“可观测性的界限” （Horizon of Observability），是一个从物理学和“可观测的宇宙”这个提法当中灵活借鉴而来的概念。诺亚•弗里德（Noah Friedkin）发现在社会网络中，人们对于自己所在的自我中心网非常了解（错误率约为30%），其所报告数据质量与通过自我报告的方式收集的数据质量一样好。二度网络距离的错误率跃为70%，三度网络距离的错误率则高达100%。</p>

<p>在诸如推特这种在线社会网络，因为对于朋友的定义非常松散以及电脑辅助的信息保存方式，自我中心网的半径要大很多。信任和影响力所流经的人际网络渠道并不太稳固，所以分析一个网络半径大于3的自我中心网的将会是一个错误。当我们研究通过一系列转发的形式而进行的信息扩散时（我们将在第6章介绍），深度优先的搜索方式将替代广度优先的策略而被使用。</p>

<p>###使用Python提取和可视化自我中心网
提取自我中心网非常简单，因为NetworkX提供一个现成的内置函数来完成这个工作：</p>

<pre><code>&gt;&gt;&gt; net.ego_graph(cc,'justinbieber')
&lt;networkx.classes.multigraph.MultiGraph object at 0x1ad54090&gt;
</code></pre>

<p>是的，不管信不信，贾斯汀•比伯（Justin Bieber）也在埃及转发网络数据当中。他的自我中心网早已经出现于本书中，见图1-11。
这个ego_graph函数返回一个NetworkX图对象，并且所有的常见的度量（程度中心性，居间中心性等）能够通过它计算。</p>

<p>但是，一些其它的简单的度量并未被纳入其中。知道一个自我中心网的规模对于理解一个人转发的（或收到的）信息能够传播的范围非常重要。
另外一个度量被称为聚类系数（clustering coefficient）——本质上，它测量了你的朋友彼此之间也是朋友的比例（也就是人们之间的相互信任程度）。这个度量可以被应用于整个网络当中——但是对于一个密度差异很大并且有多个核心的大的网络，平均的聚类系数很难解读。在自我中心网当中，对于聚类系数的解释非常简单——一个自我中心网，稠密且嵌入了很多相互信任的节点，具有一个较高的聚类系数。由一个单一向外“广播”的核心节点和众多“听众”构成的星型网络，则具有一个较低的聚类系数。
让我们开始探索一下埃及数据中的一些自我中心网：</p>

<pre><code>## 我们需要将自我中心网从一个多图转化为一个简单的图。
&gt;&gt;&gt; bieb = net.Graph(net.ego_graph(cc,'justinbieber', radius=2))
&gt;&gt;&gt; len(bieb)
22
&gt;&gt;&gt; net.average_clustering(bieb)
0.0
</code></pre>

<p>贾斯汀•比伯(Justin Bieber)的名人地位并未能够在这个特定例子中帮到他——在他的九百万个关注者当中，仅仅有二十二个人转发了他的关于埃及革命的信息。他的聚类系数表明他是一位纯粹的“广播者”，并未被嵌入他的粉丝的信任网络中——或者，至少，他并不在一个关心世界政治的信任网络中。</p>

<p>让我们现在探索一个不同类型的名人——威尔•戈宁(Wael Ghonim)，新一代的埃及人，Google的主管，推特的重度使用者：</p>

<pre><code>&gt;&gt;&gt; ghonim= net.Graph(net.ego_graph(cc,'Ghonim', radius=2))
&gt;&gt;&gt; len(ghonim)
3450
&gt;&gt;&gt; net.average_clustering(ghonim)
0.22613518489812276
</code></pre>

<p>威尔• 戈宁不仅有一个巨大的转发网络（尽管比贾斯汀•比伯的粉丝少100倍），他的自我中心网是一个人们从他这里以及其他人那里转发信息的信任网络，一个革命的信息可以很容易扩散和持续的网络。
在下一部分我们要讨论的结构洞和三元组分析对于自我中心网同样非常适用——所以敬请期待并且开始分析你自己的数据！
4.3三元组
一个三元组其实就是三个节点以某种形式相互链接。无论如何，在三元组分析中，情况并非如此简单。图4-2列出了所有可能的无向（undirected ）的三元组；正如你所看到的，仅有前两个类型当中的所有节点是相互链接的， 并因此具有独特的意义。有向的三元组共有16种，但我们将在本章稍后的部分讨论。</p>

<p><img src="http://farm3.staticflickr.com/2865/9457227586_25d19e8e24.jpg" alt="" /></p>

<p>图 4-2 三元组的形式</p>

<p>图字翻译：</p>

<p>闭合的三元组（图4-2中左侧）展现的是一个完全连接的群体：A，B，和C以相同强度的边相互连接。闭合的三元组的一个最简单的例子是“核心家庭”——妈妈（爱丽丝），爸爸（鲍勃）和一个孩子（卡洛尔）。当然，这些三元组可以相互重合——例如，同一个妈妈和爸爸可能还有另外一个儿子（大卫），这种情况下三元组不止有一个，而是四个：</p>

<pre><code>[爱丽丝，鲍勃，卡洛尔]
[爱丽丝，鲍勃，大卫]
[卡洛尔，大卫，爱丽丝]
[卡洛尔，大卫，鲍勃]
</code></pre>

<p>这个网络结构或许代表了社会网络研究领域当中最古老的一种研究。在1908年，乔治•齐美尔，一位与马克斯•韦伯同时代的人， 与他的知识分子圈的一位成员一起写作了一篇论文《三元组论》。</p>

<p>齐美尔认为在一个二元组（dyad ）（也就是两个节点相互连接在一起）中，每个人都能够保持他们的个体性并维持一段亲密关系。二元组有助于信息和意见的交流，但它并未使得个体融入群体。在三元组当中，第三个个体成为一个平衡的本源（提供不同的意见并舒缓精神）。但第三个节点也是一个反馈的渠道——来自A的信息传递到B，然后到C，并以一种非常扭曲的形式回到A——正如一个儿童的游戏“打电话”所表明的一样。</p>

<p>作为一种不断扭曲的结果，一个三元组随着时间的推移生成一组三元组所特有的人造品——方言土语或绰号昵称，局部的规范和行为准则，共享的意义。在一个宏大的语境里，社会学家把这种人造品的累积称为文化。
或许在一个三元组的语境里，三元组是一个非常大的词语——但可以想象一下你自己的家庭或者你的朋友的家庭。或者，下载一集ABC播出的真人秀《交换女主人》（Wife Swap, 幸运地在2009年取消了），并观看两个家庭文化的在真人秀中的碰撞。</p>

<p>###大学生联谊会研究——链接的稳定性与三元组</p>

<p>另外一个相似的研究由纽科姆完成。  实际上，这个研究与现代真人秀电视节目有些（惊人的）相似，但是发生于二十世纪六十年代早期。想象一家位于密歇根的大学生联谊会 （是的，有啤酒 ） 。在学期开始，17个学生（都是白人）被招募住在一个大学生联谊会的房子里长达一个学期时间， 以交换他们的个人信息数据为条件。每周，研究者访问每一个学生成员并让他们对与之互动的成员按照1（最好）到16(最差)的顺序进行排序。</p>

<p>这个研究发现：</p>

<p>•   不对称的链接（例如“我喜欢你多过你喜欢我”）最不稳定，维系不超过两周时间。</p>

<p>•   对称的链接（二元组中的两个人以相同的程度喜欢彼此）明显更稳定。</p>

<p>•   三元组结构随着时间的推移是最稳定的，三元组中的学生们一起消弭冲突，组织活动，并奠定兄弟会内部相互交往的风气。</p>

<p>###三元组和恐怖分子</p>

<p>在本书第1章的“恐怖组织的信息网络”， 我们提到基地组织（Al Qaeda cells）在训练和准备恐怖袭击的时候被隔绝于一个安全的藏身处。这种隔绝迫使组织形成一种稠密的三元组结构，每个人都与其他人一起嵌入在三元组中。加上实际上的感觉剥夺（所有来自外部世界的信息被组织的领导者过滤），这个群体生成他们自己的超越了绰号和共有的故事的文化人造品——继续强化他们作为宗教极端分子的身份并加强他们完成袭击的决心。</p>

<p>引用马克•萨基曼（Mark Sageman） 的话来说，汉堡支部（谋划并最终参与执行了911恐怖袭击）就是——“一群人”。在分析了17个恐怖分子的生活之后，萨基曼发现驱动他们的最主要因素是他们在恐怖组织内部的社会关系。大多数人开始的时候是朋友，同事，或者亲属——并且关系因为友谊、忠诚、团结和信任的纽带而更亲密，并获得强烈的归属感和集体身份。</p>

<p><img src="http://farm3.staticflickr.com/2864/9457227588_a0b0c91341_z.jpg" alt="" /></p>

<p>图4-3 911劫机者的社会网络</p>

<p>在本书的Github库 (<a href="https://github.com/maksim2042/SNABook/chapter4)当中,你可以找到用来生成图4-3" target="_blank">https://github.com/maksim2042/SNABook/chapter4)当中,你可以找到用来生成图4-3</a> 的数据 ，并且自己分析它。数据以边列表的形式存储于文件当中，其格式如下所示：</p>

<pre><code>Hani Hanjour,Majed Moqed,5,1
Hani Hanjour,Nawaf Alhazmi,5,1
Hani Hanjour,Khalid Al-Mihdhar,5,1
</code></pre>

<p>第一列是有向边指出的节点的名字，第二列是有向边指入的节点的名字，并且接下来的两个数字表示边的强度（5=最强的边，1=最弱的边）和边被确认的程度（1=被确认的亲密关联，2=各种被记录的交往活动， 3=潜在的或计划的或未确认的交往活动）。</p>

<p>导入这个文件时，我们无法使用NetworkX内置的文件读入功能，但我们可以用短短几行代码构建一个：</p>

<pre><code>import csv ## 我们将使用内置的 CSV库
import networkx as net
# 打开文件
in_file=csv.reader(open('9_11_edgelist.txt','rb'))
g=net.Graph()
for line in in_file:
    g.add_edge(line[0],line[1],weight=line[2],conf=line[3])
</code></pre>

<p>我们还有一个标明19个劫机者曾经乘坐过的航班的属性文件。让我们也把这个数据读入：</p>

<pre><code># 首先，我们应该确认所有的额节点都具有“flight”属性
for n in g.nodes_iter(): g.node[n]['flight']='None'
attrb=csv.reader(open('9_11_attrib.txt','rb'))
for line in attrb:
    g.node[line[0]]['flight']=line[1]
</code></pre>

<p>tips：
通常有两种方法列出图中的节点。g.nodes()提供了一列节点，而g.nodes_iter()生成一个Python迭代器。迭代器仅限于在循环当中——但仅仅使用很少的内存并且在大图当中运行更快。</p>

<p>如果你现在使用默认的net.draw(g)函数将这个网络画出来，你会发现这个网络包含了几个互补相连的组元。这是因为这个数据是支离破碎和不完整的；我们仅仅关注网络中的最大组元：</p>

<pre><code># Connected_component_subgraphs()返回一系列的组元，
# 按照从最大到最小的顺序排列
components=net.connected_component_subgraphs(g)

# 找出第一个也是最大的组元
cc = components[0]
我们使用multimode.py中的一个惯用的绘图函数来绘制这张图片。这个函数读入节点属性，并根据节点属性的取值分配颜色，迅速地绘制一个惯用的彩色图片：
import networkx as net
import matplotlib.pyplot as plot
from collections import defaultdict
def plot_multimode(m,layout=net.spring_layout,
type_string='type',filename_prefix='',output_type='pdf'):
    ## 创造一个默认的颜色序列和一个空的彩色图
    colors=['r','g','b','c','m','y','k']
    colormap={}
    d=net.degree(m) #we use degree for sizing nodes
    pos=layout(m) #compute layout
    # 现在我们需要找出需要绘制不同颜色的节点构成的群体
    nodesets=defaultdict(list)
    for n in m.nodes():
        t=m.node[n][type_string]
        nodesets[t].append(n)
    ## 使用相应的颜色设置，将每组中的节点分开绘制
    print &quot;drawing nodes...&quot;
    i=0
    for key in nodesets.keys():
        ns=[d[n]*100 for n in nodesets[key]]
        net.draw_networkx_nodes(m,pos,nodelist=nodesets[key], node_size=ns,
        node_color=colors[i], alpha=0.6)
        colormap[key]=colors[i]
        i+=1
        if i==len(colors):
            i=0  ### 如果我们用光了所有的颜色，那么循环使用这些颜色
    print colormap
    ## 使用一个默认的绘图机制绘制边
    print &quot;drawing edges...&quot;
    net.draw_networkx_edges(m,pos,width=0.5,alpha=0.5)
    net.draw_networkx_labels(m,pos,font_size=8)
    plot.axis('off')
    if filename_prefix is not '':
        plot.savefig(filename_prefix+'.'+output_type)
最后，我们绘制出网络：
import multimode as mm

# type-string 指引函数某种需要辨别的属性
mm.plot_multimode(cc,type_string='flight')
</code></pre>

<p>一旦我们建立了用于三元组分析的工具，你可以使用这个数据作为一个理解三元组如何工作的测试，并与关于恐怖主义研究的大量文献潜在地联系起来。</p>

<p>###“禁止进入的三元组”和结构洞</p>

<p>我的朋友鲍勃  有一个问题。你明白的，他爱上了两个女人。一个是精力充沛的东欧美女（让我们称她为爱丽丝），另一个是来自南美洲的乐天派女孩卡若琳娜。这两位女孩中的任何一个对于鲍勃来说都是绝配，但是他无法决定。当鲍勃和爱丽丝在一块的时候，他渴望见到卡洛琳娜和她无忧无虑的态度；但他和卡洛琳娜在一起的时候，他思念爱丽丝和她美丽以及有深度的谈吐。结果，几年过去了，鲍勃依然处于病态的单身状态中。
从网络角度而言，鲍勃的窘况在于他处于图4-2的第二个三元组中。B与A和C相连——但A与C之间并没有任何连接，并且鲍勃作为图中的B应该维持这种状况如果他想继续同爱丽丝和卡洛琳娜两个人同时交往。每天，鲍勃需要调整他的日程表以确保A和C不会相见，这给鲍勃的生活带来越来越多的压力，但他同样需要确保他不会因为忘记他告诉A或C的事情或者A或者C偶尔告诉他的事情而露馅。结果，鲍勃身处焦虑之中，然而所有的事情并没有按照鲍勃所希望的那样发展。</p>

<p>我另外一个银行家朋友（Banker）身处与之相似的网络链接当中，但却对此非常高兴。他的A是AmeriCorp公司，而C是CorpAmerica公司。AmeriCorp公司在他的银行里存款并期望5%的利率。而CorpAmerica公司则按照7%的利率从他的银行借款。这样我这个银行家朋友B就获得其中的利率差——C支付的利率和A期望得到的利率之间的2%的差别。对我这个朋友而言，这2%的利率差足够他购买一个房子、一个最新款的宝马车、一个精英俱乐部的成员资格和其它的他非常喜欢的物质财富。假设A和C因为打高尔夫球而认识，他们就会同意A以6%的利率直接借款给C，并意识到撇开中间人对他们双方都有利。如果这件事情发生了，银行家B就会非常沮丧。
尽管在三元组背后的故事完全不同，鲍勃和银行家朋友的意愿却完全相同。他们都需要确保他们的开放的三元组的末端不能直接联系——也就是说A和C之间不会建立网络链接。</p>

<p>不同的人给这个三元组所取的名字不同。一些研究者称它为“禁止进入的三元组”——因为像鲍勃一样，他们认为这个三元组与压力、焦虑和同时与两个女人约会所带来的道德问题相互关联。其他人称它为“结构洞”或者“中间人结构”，并且认为一个个体所占据的结构洞的数量与其作为企业、银行、经纪人或地产代理的业绩相互关联。</p>

<p>罗纳德•伯特（Ronald Burst）  的研究表明在一个竞争性的市场当中，占据更多结构洞的商人具有更显著的高成功率。商人的成功是是通过两件事情来预测的——商人在不对称信息的条件下的开拓能力和交易能力，和商人对于创造和维持“套利机遇”过程中多带来的压力的高度容忍度。</p>

<p>###结构洞和边界跨越
结构洞具有另一个重要的使命——因为他们能够降低信息不对称性（例如，因为我的两个朋友都能够提供信息），他们也能够连接不同的社群。本书的两位作者即是社会网络研究领域的专业人士（马克斯教社会网络分析的课，艾利克斯编写社会网络分析的软件），又是专业的音乐家。事实上，我们两个是在一个摇滚音乐节上相遇的，那时我们两个各自的乐队正在那里表演。</p>

<p>所以，一个包括马克斯、马克斯在学术研究方面最亲密的合作者和他乐队中的鼓手的三元组实际上是一个结构洞。这些科学家和鼓手对于英语有基本的了解（不存在语言障碍），但找不到足够的谈论的话题。因为社会距离（social distance）（我们将在第6章讨论信息扩散的时候进一步涉及的一个术语）的原因，在他们之间存在网络链接的可能性基本为零。
我们的社群（科学家和音乐家）经常交叉。马克斯之前所在的一个乐队是全部由教授构成的，之后所在的一个摇滚乐队全部由神经科学家构成（称为“Amygdaloids” ），乐队也因此而知名。</p>

<p>但是，与那些仅仅是专业的音乐家或者科学家的人的规模相比，这些跨界者（懂科学的音乐家和懂音乐的科学家）很少。结果，这两个社群的交叉看上去像图4-4。</p>

<p><img src="http://farm3.staticflickr.com/2813/9454445729_60156911af.jpg" alt="" /></p>

<p>图4-4 跨界者示意图</p>

<p>事实上，这种事情在不同层面存在着。如果我们仔细考察科学家群体，我们发现它包含了各个主要的领域（生物学、计算机科学、人类学等），并且如果我们更仔细地看这些领域所包含的子领域，我们会发现它们都通过结构洞联系在一起。</p>

<p>在科学社群中，这非常重要。因为许多新的发现本质上都是跨学科的。例如，詹姆斯•富勒（James Fowler）  致力于神经科学与社会网络分析交叉领域的研究。</p>

<p>一些其他的领域（例如经济学）不鼓励跨越不同子领域的对话和论文发表，并对他们的理论过度保护。在这种情况下，比如存在于奥地利学派和新古典经济学之间的结构洞位置将会充满压力并很难维持——这更像鲍勃的困境而非银行家的顺境。</p>

<p>###政治中的三元组</p>

<p>图4-5展现了一个不同国家在高加索（ Caucasus）的政治合作网络 。  从现代地缘政治的角度讲，高加索是一个非常有趣的地方（看图4-6中的地图）。这是一个很小的地方，具有异常美丽的山地地貌，它夹在北面的俄罗斯 （Russia）和南面的土耳其（Turkey）和伊朗（Iran ）之间。其居民主要是基督徒和穆斯林民族的混乱得混合，并且他们开始逐渐拥护西方的国家。俄罗斯，或者土耳其（从苏联解体开始）在这里创造了一种令人诧异的地缘政治景观（大多数是令人不高兴的，至少对于当地人来说）。</p>

<p><img src="http://farm3.staticflickr.com/2893/9457227528_52e7e3a37f.jpg" alt="" /></p>

<p>图 4-5 在高加索的政治合作网络</p>

<p><img src="http://farm6.staticflickr.com/5328/9457227532_d7b2091b39.jpg" alt="" /></p>

<p>图 4-6 高加索—一个种族和语言的熔炉</p>

<p>图中的网络通过其它国家和高加索、俄罗斯、土耳其、欧盟和美国之间签订的政治合作协议和声明关系而构建，明显表明俄罗斯与其它西方国家之间的政治治理风格的差异。俄罗斯为中心的一方的网络充满了结构洞，俄罗斯实际上控制着这个网络，而边缘国家节点之间的网络链接几乎不存在。</p>

<p>唯一横向的网络链接存在于南奥塞梯（South Ossetia）和阿布哈兹(Abkhazia)之间。在本研究进行的时候，这两个地方都还是格鲁吉亚的一部分——但实际上，它们当时明显不忠于格鲁吉亚。南奥塞梯的分裂运动（或者，这是一个俄罗斯人为了巩固在该地区的影响而进行的挑拨，这取决于读者的新闻来源是俄罗斯媒体还是美国媒体）在两年内遭到了格鲁吉亚军队一个短暂而血腥的镇压。之后，南奥塞梯和阿布哈兹这两个地方都宣布独立并正式与俄罗斯建立盟友关系。</p>

<p>同时，西方国家一方的网络表现出一种具有较多亲密关系和横向连接的特征。这将减弱超级大国的影响力，因为横向的网络链接降低了（超级国家）的效率和直接影响。同时，这种三元组结构更加稳定并且不需要很多的力量去维持。</p>

<p>###有向的三元组
理论足够了，让我们开始编写一些代码！</p>

<p>图4-7给出了所有的可能的有向的三元组。在一个有向的三元组当中，我们同时考虑单向的边和双向的边；因此总共有16种可能的情况，而非4种情况。我们将对这些形状进行一些解读，但首先让我们定义一种对其进行分类的方法。这种计数和分类的方法或许有一些晦涩难懂，但自从1972年开始，它就成为了这个领域的学术文献中的一种标准 。</p>

<p><img src="http://farm4.staticflickr.com/3750/9454445677_5e5a60f507.jpg" alt="" /></p>

<p>图4-7 有向网络中所有可能存在的三元组</p>

<p>这些三元组按照1到16 的顺序进行编号，每一个都有一个代码。这些代码按照如下方式进行阅读：</p>

<p>•   第一个数字代表了双向链接的总数量。</p>

<p>•   第二个数字代表了单向链接的总数量。</p>

<p>•   第三个数字代表了不存在的网络链接的总数量。</p>

<p>•   字母用来区分相同三元组的不同形式——U代表了“向上”，D代表了“向下”，C代表了“传递”（也就是说有两条路径指向相同的节点）</p>

<p>图中的三元组1到3是未连在一起的，三元组4到8和11代表结构洞的不同形式。三元组9、10和12到16是紧密型三元组的不同形式。</p>

<p>###分析真实网络中的三元组</p>

<p>对于一个真实网络的三元组分析的过程成为“三元组普查（triad census）”。在这个过程当中，对于每一个节点，我们计算16种类型三元组出现的频数以决定这个节点在网络中的角色。例如，一个节点具有较多的三元组4、7和11（也就是说有较多的流出的网络链接和结构洞）是一个信息的来源或者潜在的小组领导者。</p>

<p>执行三元组普查，我们需要一种仍未被纳入NetworkX的一种算法——三元组普查算法 。从Github下载第4章所要用的算法包 ，修改系统目录为下载文件所在的路径，并开启Python：</p>

<pre><code>&gt;&gt;&gt; import networkx as net
&gt;&gt;&gt; import tradic
&gt;&gt;&gt; import draw_triads
</code></pre>

<p>这个draw_triads函数可以重新绘制出图4-7.</p>

<p>现在，让我们应用三元组普查到一些抽样数据当中去（比如图4-8当中的风筝网络）：</p>

<pre><code>## 生成一个有向的风筝网络
&gt;&gt;&gt; g=net.DiGraph(net.krackhardt_kite_graph())
## 执行三元组普查程序
&gt;&gt;&gt; census, node_census = triadic.triadic_census(g)
&gt;&gt;&gt; census
{'201': 24, '021C': 0, '021D': 0, '210': 0,
'120U': 0, '030C': 0, '003': 22, '300': 11,
'012': 0, '021U': 0, '120D': 0, '102': 63,
'111U': 0, '030T': 0, '120C': 0, '111D': 0}
</code></pre>

<p><img src="http://farm3.staticflickr.com/2881/9457227436_bbca40d39d_n.jpg" alt="" /></p>

<p>图 4-8 魁克哈特风筝社会网络</p>

<p>三元组普查函数返回了两个结果——一个包含了网络的所有结果的Python字典，和一个包含了个体节点的所有结果的字典的字典。</p>

<p>在风筝图当中，这个程序找到24个结构洞类型三元组（代码为201）和11个紧密型三元组（代码为300）。这意味着在网络中存在着一些联系特别紧密的区域和一些充满很多结构洞的区域。当然这个发现对于这个图来说是显而易见得到——但对于一些大的网络来说就不是如此明显。</p>

<p>结构洞型三元组和紧密型三元组的比例也是非常重要的——一个等级制度主要是由结构洞构成的，而平等主义的网络结构中紧密型三元组具有较高的比例。</p>

<p>简而言之，一个三元组普查使得我们可以对一个网络结构的宏观层面做出一种高级的结论。但是，这在微观水平上同样有趣。下面的代码生成一个三元组普查表格，其结果在表4-1中：</p>

<pre><code>keys=node_census.values()[1].keys()
## 生成一个表格的标题  
print '| Node |', ' | '.join(keys)
## 生成表格的内容
## 需要一点小技巧区将整数转为字符
for k in node_census.keys():
print '|', k, '|',' | '.join([str(v) for v in node_census[k].values()])
</code></pre>

<p>节点  201 021C 021D   210 120U    030C    003 300 012 021U    120D    102 111U    030T    120C    111D</p>

<pre><code>0   8   0   0   0   0   0   0   4   0   0   0   14  0   0   0   0
1   4   0   0   0   0   0   0   3   0   0   0   11  0   0   0   0
2   4   0   0   0   0   0   0   1   0   0   0   7   0   0   0   0
3   3   0   0   0   0   0   0   2   0   0   0   7   0   0   0   0
4   2   0   0   0   0   0   0   0   0   0   0   4   0   0   0   0
5   1   0   0   0   0   0   0   1   0   0   0   5   0   0   0   0
6   1   0   0   0   0   0   0   0   0   0   0   3   0   0   0   0
7   1   0   0   0   0   0   0   0   0   0   0   5   0   0   0   0
8   0   0   0   0   0   0   0   0   0   0   0   7   0   0   0   0
9   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
</code></pre>

<p>表4-1 风筝网络内部的三元组普查</p>

<p>现在让我看一下主要的三元组类型:紧密型三元组（代码为300）和结构洞型三元组（代码为201）。</p>

<p>###真实数据</p>

<p>让我们现在对在本章前面部分用到的9/11劫机数据执行一次三元组普查，并找出谁拥有最多的派系（紧密型三元组，代码为300）：</p>

<pre><code>census, node_census = triadic.triadic_census(cc)

## 仅仅得到紧密型三元组的数量，并按照其数值进行降序排列
closed_triads=[[-k,v] for k,v in sorted([[-node_census[k]['300'],k] for k in node_census.keys()])]
</code></pre>

<p>列表中排名最高的人有一个我们很熟悉的姓氏：穆罕默德•阿塔（Mohammed Atta）是最初策划911袭击的汉堡支部的一份子，并且是美国航空公司的第11次航班劫机后的飞行员，他驾驶着飞机撞在了世贸中心的北楼上。</p>

<p>##4.4派系
虽然我们或许可以直觉地将社会网络中的派系理解为彼此紧密相连的、有黏着力的一群人，在社会网络分析领域对已派系有一个正式的、更为严格的数学定义。</p>

<p>对于一个给定的图来说，一个派系被定义为其中的一个最大的完全子图（ maximal complete subgraph ）——也就是说，群体中的每个个体都与其他的每一个人相连。“最大”意味着这个派系无法再增加节点，因为如果将其它节点也算入派系，将降低派系内部连通的紧密程度。从本质上讲，一个派系包含着几个相互重叠的紧密型三元组，并且继承着紧密型三元组的许多文化生成功能和放大特征。</p>

<p>一个派系必须生成共识，否则就会解体——这是为什么在方言里，派系经常被认为与其他派系存在冲突。其实派系与冲突的关系非常容易理解：拥有一个共同的敌人（或者一组共同的敌人）使得派系内部更加团结。我们将在第6章讨论一些关于冲突和派系的含义。但是现在，让我们看一下是否可以在一些样本网络中找到派系。</p>

<p>###检测派系
作为测试，让我们再看一下高加索地缘政治的数据。这一次，我们将要探索不同国家之间的经济关系（图4-9）。在这个数据当中，经济合作水平的取值范围为0到1之间——1表示一个紧密的或者说独占的网络链接，0表示完全没有经济合作关系：</p>

<pre><code>&gt;&gt;&gt; eco=net.read_pajek(&quot;economic.net&quot;)
&gt;&gt;&gt; net.draw(eco)
</code></pre>

<p><img src="http://farm8.staticflickr.com/7335/9457227442_438f567e5c_c.jpg" alt="" /></p>

<p>图 4-9 高加索地区的经济联盟与联合行动</p>

<p>这个数据清晰地表明在这个地区存在着两个不同的力量——以西方国家为中心的一方和以俄罗斯为中心的一方；当地和地方性的经济联系经常是不存在的，作为最近的地理上的邻居（例如亚美尼亚（Armenia）和阿塞拜疆（Azerbaijan）），往往将彼此看作敌人并按此选择与不同的超级大国建立关系。伊朗和土耳其扮演着“捣乱分子”的角色——一个与伊朗有较多经济联系的国家不会和美国有联系，并因此被迫与俄罗斯结盟。当然，石油和天然气也起着非常重要的作用。
一个像这样的结构容易孕育派系。我们看一下是否能够从其中找到派系。首先，我们要丢掉低水平的联系（边的权重 &lt; 0.5）以凸显网络的核心：</p>

<pre><code>&gt;&gt;&gt; e2=trim_edges(eco, weight=0.5)
&gt;&gt;&gt; cliques = list(net.find_cliques(eco))
&gt;&gt;&gt; cliques
[['EU', 'Turkey', 'Russia'],
['EU', 'Turkey', 'USA'],
['EU', 'Azerbajan'],
['EU', 'Georgia'],
['EU', 'Kazakhstan', 'Russia'],
['EU', 'Kazakhstan', 'USA'], ['EU', 'Armenia'],
['South Osetia', 'Russia'],
['Nagorni Karabakh', 'Armenia'],
['Chechnya', 'Russia'],
['Abkhazia', 'Russia']]
</code></pre>

<p>我们大略地看一下派系的结果：</p>

<p>•   [EU, Turkey, Russia], [EU, Turkey, USA]–    代表着（两个）超级大国和对于土耳其是否应该成为欧盟成员的论辩的双方。</p>

<p>•   [EU, Azerbaijan], [EU, Georgia]–    在高加索地区与西方结盟的国家；阿塞拜疆（Azerbaijan）是主要的石油生产国，并且一个英国石油公司所拥有的石油管道穿过阿塞拜疆从格鲁吉亚到达黑海。</p>

<p>•   [South Ossetia, Russia], [Nagorni Karabakh, Armenia], [Chechnya, Russia], [Abkhazia, Russia]–   所有的最近的冲突 起源于当地的小的共和政体从拥护西方转而拥护俄罗斯（自愿地或者被强迫地）。</p>

<p>•   [EU, Kazakhstan, Russia], [EU, Kazakhstan, USA]–    哈萨克斯坦是一个主要的天然气生产国，其天然气主要通过俄罗斯拥有的石油管道和液态天然气设施卖给欧盟和美国。</p>

<p>简而言之，派系算法生成的结果可以很快地被一个熟悉该领域的人解读。</p>

<p>不幸的是，这些派系之间大多是重叠的，并且一个单一的事件或现象可能导致多个派系。其他的算法（n-clans, k_plexes等）可以帮助解决这个问题——但它们尚未被融入到NetworkX当中，并且它们的应用也超出了本书的范围。</p>

<p>我们将在下一个部分通过聚类的方法解决这个问题。</p>

<p>##4.5分层聚类
我们将要接触的（虽然很简略地）另一个类型的算法是聚类算法。聚类算法包罗万象、异常宽广，或许在其它的书籍中被阐述得更好——但我会简单地介绍聚类算法在社会网络分析中的应用，并提供一个从聚类算法中可以得出有用结论的简单例子。</p>

<p>首先我们回到“距离”的概念。我们可以用很多办法定义距离——从地理距离到在地面上旅行经过的距离，再到以时间计量的距离（例如，从一个地方A到达另一个地方B所要花费的时间），等。在社会网络分析中，我们发现两种距离的概念最为有用：一个是节点之间的图距离（或路径距离）；另一个是以相似度计量的距离（也就是说，如果节点之间在某个方面上相似，我们就认为它们靠得更紧密）。</p>

<p>在之前的章节中我们使用的高加索网络中，图距离的矩阵如表4-2所示：</p>

<pre><code>    TR  SO  GE  IR  TK  US  AZ  CH  AR  EU  NK  KZ  RU  AB
TR  0   2   1   1   1   1   1   2   1   1   2   1   1   2
SO  2   0   2   2   2   2   2   2   2   2   3   2   1   2
GE  1   2   0   1   1   1   1   2   1   1   2   1   1   2
IR  1   2   1   0   1   2   1   2   1   1   2   1   1   2
TK  1   2   1   1   0   1   1   2   1   1   2   1   1   0
US  1   2   1   2   1   0   1   2   1   1   2   1   1   2
AZ  1   2   1   1   1   1   0   2   2   1   3   1   1   3
CH  2   2   2   2   2   2   2   0   2   2   3   2   1   2
AR  1   2   1   1   1   1   2   2   0   1   1   1   1   2
EU  1   2   1   1   1   1   1   2   1   0   2   1   1   2
NK  2   3   2   2   2   2   3   3   1   2   0   2   2   2
KZ  1   2   1   1   1   1   1   2   1   1   2   0   1   2
RU  1   1   1   1   1   1   1   1   1   1   2   1   0   1
AB  2   2   2   2   0   2   3   2   2   2   2   2   1   0
</code></pre>

<p>表 4-2 高加索网络中的网络距离</p>

<p>这当然和地理距离非常不同，并且描绘了在高加索区域中国家之间的合作和拥护关系是交织在一起的，每个个体不是被其本地的联盟国家所环绕，而是被潜在的对手所环绕。</p>

<p>让我们看一下是否可以在经济网络中找到这些相互敌对的群集（cluster，或译作“簇”）。我们将会使用SciPy包中一个的分层聚类方法和一小段由德鲁•康威（Drew Conway）  原创、在本书中被大幅改进的代码。</p>

<p>###算法
图4-10展现了（以一种程式化的方式）分层聚类的算法。算法大致按照以下步骤运行：</p>

<ol>
<li>从最低层开始，每一个节点被分配为一个只包含自己的群集。</li>
<li>使用距离表（表4-2）找到距离最近的一对节点并将它们合并为一个群集。</li>
<li>重新就算距离表，把刚刚合并的群集看作一个新的节点。</li>
<li>重复步骤2和3，直到所有的网络中的节点都已经被合并到一个大得多的群集中（示意图中的最高层）</li>
<li>选择介于最高层和最底层之间的一个有用的聚类门槛——这需要人工干预而无法机器自动完成。</li>
</ol>

<p><img src="http://farm4.staticflickr.com/3808/9457227414_bb8889b4c4.jpg" alt="" /></p>

<p>图 4-10 分层聚类</p>

<p>步骤3值得更多的思考。如何计算一个群集和一个节点之间的距离？如何计算两个群集之间的距离？有三个方法可以做这件事情：</p>

<p>•   单个链接：按照最小的最低配对距离（minimum pairwise distance）合并两个群集。</p>

<p>•   平均链接：按照最小的平均配对距离（average pairwise distance）合并两个群集。</p>

<p>•   最大链接或完全链接： 按照最小的最高配对距离（maximum pairwise distance）合并两个群集。</p>

<p>完全链接方法被认为对异常值非常敏感；单个链接方法容易形成链状的、一长串的群集，这与我们关于群集的意义的直觉理解不同；平均链接方法是其它两种方法的折中，也是最常用的方法。</p>

<p>###城市聚类
为了更好地展现聚类是如何实现的，让我们来思考一个美国本土城市的聚类问题。初始的距离表如下所示；我们将使用单个链接的聚类方法：</p>

<p>【此处 插入p83表格】</p>

<p>在前两步当中，我们要合并波斯顿、纽约和华盛顿为一个群集。我们将会发现东海岸城市被合并为一个它们自己的群集：</p>

<p>【此处插入p84表格1】</p>

<p>跳过一些步骤，芝加哥进入东海岸城市群集，而旧金山和西雅图构成了西海岸城市群集。严格的说，芝加哥和丹佛应该形成一个中西部城市群集——但因为我们使用了单个链接距离量度，芝加哥结果与东海岸城市群集的距离比与丹佛的距离更近。</p>

<p>【此处插入p84表格2】</p>

<p>此时，仅仅剩下迈阿密和丹佛的群集仍未分配。在接下来的几步当中，丹佛加入芝加哥所在的东海岸城市群集。此时，我认为进一步的聚类不再有任何意义。</p>

<p>长距离的链条（从东海岸城市群集到芝加哥，再到丹佛，最后到达西海岸城市群集）是单个距离量度方法的一个众所周知的不足之处。如果我们此时使用平均链接方法，聚类的结果将会更为清晰。获得更为清晰结果的代价是较高的计算复杂性——这使得平均链接聚类方法不适用于非常大的数据。</p>

<p>###准备数据和聚类
让我们现在开始在高加索网络数据中应用分层聚类的方法。首先，需要计算距离矩阵。NetworkX提供了一个函数可以生成这样的一个矩阵——但返回的结果是一个嵌入字典的字典（dict of dicts）。这种返回数据的格式不适于做进一步的运算，并且需要被转换到SciPy的矩阵中来。因为矩阵形式的数据不会保留节点的标签，我们构建了另外一个数组来保存这些节点的标签。</p>

<p>最后，我们执行SciPy的分层聚类算法并得到所有聚类结果的树形图，这个树形图与图4-10类似。我们需要确定一个门槛值——此处，我们任意挑选一个数值，但是因为它是一个参数，所以很容易被改进以得到更有意义的结果。</p>

<p>例4-1 分层聚类算法</p>

<pre><code>__author__ = &quot;&quot;&quot;\n&quot;&quot;&quot;.join(['Maksim Tsvetovat &lt;maksim@tsvetovat.org',
                  'Drew Conway &lt;drew.conway@nyu.edu&gt;',
                             'Aric Hagberg &lt;hagberg@lanl.gov&gt;'])
from collections import defaultdict
import networkx as nx
import numpy
from scipy.cluster import hierarchy
from scipy.spatial import distance
import matplotlib.pyplot as plt
def create_hc(G, t=1.0):
    &quot;&quot;&quot;
    从距离矩阵中创造一个图G的分层聚类
    马克西姆注：对带有标签的图进行聚类的前处理和后处理，并返回聚类的结果
    参数化门槛值之后，其取值范围应该通过对每个数据进行尝试的基础上确定
    &quot;&quot;&quot;
    &quot;&quot;&quot;在对德鲁•康威（Drew Conway）编写的代码进行优化的基础上而来&quot;&quot;&quot;
    ## 创造最短路径距离矩阵，但是保留节点标签
    labels=G.nodes()
    path_length=nx.all_pairs_shortest_path_length(G)
    distances=numpy.zeros((len(G),len(G)))
    i=0
    for u,p in path_length.items():
        j=0
        for v,d in p.items():
            distances[i][j]=d
            distances[j][i]=d
            if i==j: distances[i][j]=0
            j+=1
        i+=1
    # 创造分层聚类
    Y=distance.squareform(distances)
    Z=hierarchy.complete(Y) # Creates HC using farthest point linkage
    # 这种划分的选择是任意的，仅仅为了说明 的目的
                          membership=list(hierarchy.fcluster(Z,t=t))
    # 为块模型（blockmodel）创造一系列的列表
    partition=defaultdict(list)
    for n,p in zip(list(range(len(G))),membership):
    partition[p].append(labels[n])
    return list(partition.values())
    # Create collection of lists for blockmodel
    partition=defaultdict(list)
    for n,p in zip(list(range(len(G))),membership):
        partition[p].append(labels[n])
    return list(partition.values())
</code></pre>

<p>运行上述分层聚类算法：</p>

<pre><code>&gt;&gt;&gt; import hc
&gt;&gt;&gt; hc.create_hc(eco)
[['Turkmenistan', 'Nagorni Karabakh', 'Russia', 'Abkhazia'],
['USA', 'Armenia', 'EU', 'Kazakhstan'],
['Turkey', 'Georgia', 'Iran', 'Azerbaijan'],
['Chechnya'], ['South Osetia']]
</code></pre>

<p>这个结果从直觉上来说非常容易理解——[[&lsquo;Turkmenistan&rsquo;, &lsquo;Nagorni Karabakh&rsquo;, &lsquo;Russia&rsquo;, &lsquo;Abkhazia&rsquo;]是一个以俄罗斯为中心的群集；而[&lsquo;USA&rsquo;, &lsquo;Armenia&rsquo;, &lsquo;EU&rsquo;, &lsquo;Kazakhstan&rsquo;]这个群集主要是跟天然气买卖和运输有关系的；[&lsquo;Turkey&rsquo;, &lsquo;Georgia&rsquo;, &lsquo;Iran&rsquo;, &lsquo;Azerbaijan&rsquo;]这个群集代表的是支持伊斯兰和波斯的态度。对格鲁吉亚（Georgia）的聚类有一些不合适，因为它在政治上是与天主教和西方国家结盟的，但它在经济上与阿塞拜疆和土耳其联系紧密，因而抵消了它亲西方的面貌。剩下的聚类结果则充满了异常值 ——实际上，这些小国家也给这个世界带来了不少麻烦。</p>

<p>###块模型
一个块模型（block model）是一个从原始网络中提取出来的简化的网络，其中处于同一个群集中的节点被看作是一个节点，而所有的原始的节点之间的关系也被累加为块之间的关系。
在我们作为例子的数据当中，一个块模型所展现的是俄罗斯为中心的群集（0）、西方为中心的群集（1）和伊斯兰为中心的群集(2)之间的关系。而群集3和4主要是一些小的、与俄罗斯联系紧密的、但彼此之间几乎不存在任何联系的共和国——因为俄罗斯对于周边的附属国家的管理是高度中心化的。</p>

<p>计算块模型，首先需要计算并保存分层聚类的结果，然后需要将群集划分的结果存储为一个列表并在此基础上对原始的图运行块模型。结果如图4-11所示。</p>

<pre><code>&gt;&gt;&gt; clusters=hc.create_hc(eco)
&gt;&gt;&gt; M=nx.blockmodel(eco,clusters)
&gt;&gt;&gt; net.draw(M)
</code></pre>

<p><img src="http://farm4.staticflickr.com/3797/9457227386_6d225080a1.jpg" alt="" /></p>

<p>图4-11 高加索网络的块模型</p>

<p>hiclus_blockmodel.py提供了一个可以被应用到所有图的一个更精细的绘图方法：</p>

<p>例4-2 同时绘制一个网络图及其块模型</p>

<pre><code>    __author__ = &quot;&quot;&quot;\n&quot;&quot;&quot;.join(['Maksim Tsvetovat &lt;maksim@tsvetovat.org',
      'Drew Conway &lt;drew.conway@nyu.edu&gt;',
                      'Aric Hagberg &lt;hagberg@lanl.gov&gt;'])

    from collections import defaultdict
    import networkx as nx
    import numpy
    from scipy.cluster import hierarchy
    from scipy.spatial import distance
    import matplotlib.pyplot as plt
    import hc

    &quot;&quot;&quot;在原始网络旁边绘制一个块模型&quot;&quot;&quot;

    def hiclus_blockmodel(G):
        # 提取最大的联通组元
        H=nx.connected_component_subgraphs(G)[0]
        # 使用分层聚类进行分隔
        partitions=hc.create_hc(H)
        # 构建块模型图
        BM=nx.blockmodel(H,partitions)

        # 绘制原始图
        pos=nx.spring_layout(H,iterations=100)
        fig=plt.figure(1,figsize=(6,10))
        ax=fig.add_subplot(211)
        nx.draw(H,pos,with_labels=False,node_size=10)
        plt.xlim(0,1)
        plt.ylim(0,1)

        # 绘制块模型
        # 使用带有权重的边
        # 以群集中包含的节点数量表示块模型中的节点大小
        node_size=[BM.node[x]['nnodes']*10 for x in BM.nodes()]
        edge_width=[(2*d['weight']) for (u,v,d) in BM.edges(data=True)]
        # Set positions to mean of positions of internal nodes from original graph
        posBM={}
        for n in BM:
            xy=numpy.array([pos[u] for u in BM.node[n]['graph']])
            posBM[n]=xy.mean(axis=0)
        ax=fig.add_subplot(212)
        nx.draw(BM,posBM,node_size=node_size,width=edge_width,with_labels=False)
        plt.xlim(0,1)
        plt.ylim(0,1)
        plt.axis('off')
</code></pre>

<p>##4.6三元组、网络密度和冲突</p>

<p>在本章中——实际上对于本书中截止现在所涉及的所有内容——我们所讨论的都是关于包含一种类型节点和一种类型的边的均匀网络（uniform network）。但是，后面涉及的内容会变得越来越有趣。</p>

<p>设想我们有两种类型的边而不是一种类型的边——友谊和冲突。我们也将在二元组和三元组的层面上引入更多变化。</p>

<p>我们都已经经历过社会混乱——或者甚至曾经卷入其中。比如一对结婚很久的夫妇决定离婚，于是他们的朋友们马上面临决策的困难。置身于这对夫妇的任何一方都会感到压力，于是可能给持续很久的友谊关系带来破坏，并把一个本来联系紧密的网络分割成丈夫阵营和妻子阵营。当分裂造成的伤害被平复，建立新的友谊关系和恋爱关系的空间重新出现，于是类似的循环再次开始。
我们可以使用一些非常简单的规则来为这个过程建立模型（以下规则是有先后顺序的）：</p>

<ol>
<li>我的朋友的朋友也是我的朋友（使得一个结构洞闭合）。</li>
<li>我的朋友的敌人也是我的敌人（使得三元组到达平衡状态）。</li>
<li>我的敌人的朋友是我的敌人。</li>
<li>我的敌人的敌人是我的朋友。</li>
</ol>

<p>实际上，从另一种角度看，规则2,3和4描述的是相同的（无向的）三元组，因此我们把它们都称之为“规则2”（如图4-12）。这些规则实际上很早就用来尝试描述文明史中的社会复杂性；第一次提及这些规则是在《圣经》当中（出埃及 23:22，在其它的章节中也曾出现）</p>

<p><img src="http://farm8.staticflickr.com/7391/9454445573_292a308fe4_n.jpg" alt="" /></p>

<p>图 4-12 三元组演化的规则（伴随着冲突）</p>

<p>让我们从一个违反了规则1或者规则2的社会网络中的行为开始：如果我们从一组互不相连的节点开始，并且以一个固定的概率随机的连接这些节点，最后我们会得到一个节点度分布为正态分布的简单的随机图（一个厄多斯随机图）。网络的密度（也就是网络中实际存在链接数量除以可能存在的链接数量）将会上升直到每个节点都和其它节点相连（一个完全图或者派系）。当然，这并没有那么有趣。</p>

<p>让我们现在回到规则1。如果存在一个开放的三元组 A→B→C，按照某种概率，我们也将添加一条链接A→C。我们仍旧可以随机地添加链接，所以，最初这个网络将会线性地增长。直到某一个时刻达到链接的临界点，然后每个新增加的链接都会制造出一个开放的三元组。这个开放的三元组将会按照规则1的要求被闭合，其结果是制造出更多的开放的三元组，这些新增的三元组随后被闭合，这个过程将不断进行下去。</p>

<p>在某种意义上讲，网络从线性增长过渡到指数形式的增长。它像病毒一样传播开来（图4-13）！链接的密度迅速增长，直到没有新的链接可以增加并且我们得到一个全联通的图。当然，在现实当中，对于一个网络存在一个可能的链接数量的限制，也就是饱和密度（saturation density）。这个密度可以是网络自身的特征，或者是这个网络所在的环境——或者是规则2的结果（正如在我们的模型当中）。</p>

<p><img src="http://farm4.staticflickr.com/3791/9457227340_f29cef0a30.jpg" alt="" /></p>

<p>图 4-13  按照规则1使三元组闭合</p>

<p>通过改变一个友谊关系为敌对关系，冲突以一个恒定的概率被引入网络演化当中。图4-14刻画了可能的演化形式。在这个简单的例子当中，一个包含4个闭合三元组的网络被作用于其一个边上的冲突所扰动。三元组A-B-C开始因为B和C之间的冲突而变得不平衡；因此A被迫以一种随机的方式选择站在冲突双方的哪一边，并选择与B和C中的哪一个继续保持朋友关系。在A-C这条边上施加一个冲突迫使另一个三元组（A-C-D）变得不平衡，并将节点D引入到冲突中来。如果节点D选择把节点C从整个网络中孤立出来，冲突的蔓延终止。但是，如果D选择孤立节点A， 这将导致冲入进一步蔓延并破坏更多的网络链接。拥有更多的链接增加一个节点形成更多的网络链接的概率，但是也增加了两个节点之间的冲突蔓延到整个网络的可能性（如图4-14）。</p>

<p><img src="http://farm4.staticflickr.com/3803/9457227314_4b071eea92.jpg" alt="" /></p>

<p>图 4-14 冲突的蔓延</p>

<p>冲突蔓延的结果是网络密度再也不可能增长到接近100%的程度；但相反，一旦它到达了一个“第二临界值”，冲突会变得更加突出（如图4-15所示）并使得网络密度降低。这类行为被称为自组织的临界性——我的模型仅仅提供一种在社会网络中生成这种效果的简单方法。这与森林火模型中的方法类似：森林的密度越大，下一场森林火演变为灾难的可能性越大——允许小的火灾降低森林密度到某种水平上使得大多数火灾被相对得很好地控制。</p>

<p><img src="http://farm8.staticflickr.com/7291/9457227330_10d6205b0c_o.png" alt="" /></p>

<p>图 4-15  按照规则2运行的冲突的蔓延</p>

<p>我们将在第6章讨论更多的网络动态——但同时，现在是开始了解包含不同类型节点的社会网络数据的时候了——这些数据更接近于我们所熟悉的社会网络。</p>
      </div>

      

    </div>
  </div>

</article>






<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "chengjunwang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2016 Cheng-Jun Wang &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">

          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">引用</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> 复制
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//chengjunwang.disqus.com/count.js" defer="defer"></script>
    

    

    
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

